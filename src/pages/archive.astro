---
import Layout from "../layouts/Layout.astro";
import { getCollection } from 'astro:content';

// Get all blog posts and sort by date
const allPosts = await getCollection('blog');
const posts = allPosts.sort((a, b) =>
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Helper function to create proper URLs
const getUrl = (path: string) => {
  const base = import.meta.env.BASE_URL || '/';
  return base === '/' ? path : base + path;
};
---

<Layout>
    <div style="max-width: 1200px; margin: 0 auto; flex: 1; background-color: #f6f2ea; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);">

        <!-- Header Section -->
        <section style="padding: 60px 20px 40px; background-color: #FBF9F4; text-align: center;">
            <h1 style="font-family: 'Playfair Display', serif; font-size: 48px; font-weight: 600; color: #2F4858; margin-bottom: 20px;">
                Archive
            </h1>
            <div style="width: 64px; height: 3px; background: #B08A30; margin: 0 auto 20px;"></div>
            <p style="max-width: 700px; font-size: 18px; line-height: 1.6; color: #64748b; margin: 0 auto;">
                A complete collection of insights on wealth, history, and the timeless principles of prosperity.
            </p>
        </section>

        <!-- Posts Grid -->
        <section style="padding: 60px 0; background-color: #FBF9F4;">
            <div style="max-width: 900px; margin: 0 auto; padding: 0 20px;">
                <div style="display: flex; flex-direction: column; gap: 30px;">
                    {posts.length > 0 ? (
                        posts.map((post) => (
                            <div style="border-bottom: 1px solid #e5e7eb; padding-bottom: 30px;">
                                <div style="padding: 15px;">
                                    <a href={getUrl(`/blog/${post.slug}`)} style="text-decoration: none;">
                                        <div style="display: flex; flex-direction: column; gap: 12px;">
                                            <h2 style="font-size: 28px; color: #2F4858; font-family: 'Playfair Display', serif;">
                                                {post.data.title}
                                            </h2>
                                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 8px;">
                                                {post.data.tags.map((tag) => (
                                                    <span style="background-color: #f9f9f9; border: 2px solid #B08A30; color: #7f1d1d; padding: 4px 12px; border-radius: 20px; font-size: 14px;">
                                                        {tag}
                                                    </span>
                                                ))}
                                            </div>
                                            <p style="color: #6b7280; padding: 8px 0; margin-bottom: 8px;">
                                                {post.data.date.toLocaleDateString("en-US", {
                                                    year: "numeric",
                                                    month: "long",
                                                    day: "numeric",
                                                })}
                                            </p>
                                            <div style="color: #374151; font-size: 18px; line-height: 1.6;">
                                                {post.data.description}
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        ))
                    ) : (
                        <div style="text-align: center; padding: 60px 0;">
                            <h3 style="font-size: 24px; font-weight: 600; margin-bottom: 15px; color: #2F4858; font-family: 'Playfair Display', serif;">
                                Coming Soon
                            </h3>
                            <p style="color: #64748b;">
                                The archive is being prepared. Check back soon for fascinating insights into wealth through the ages.
                            </p>
                        </div>
                    )}
                </div>
            </div>
        </section>

        <!-- Topics Filter -->
        <section style="padding: 60px 0; background-color: #f6f2ea;">
            <div style="max-width: 900px; margin: 0 auto; padding: 0 20px; text-align: center;">
                <h2 style="font-family: 'Playfair Display', serif; font-size: 28px; font-weight: 600; margin-bottom: 30px; color: #2F4858;">
                    Browse by Topic
                </h2>
                <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px;">
                    <span style="padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid #d1d5db; color: #2F4858; background-color: #FBF9F4;">
                        Historical Wealth
                    </span>
                    <span style="padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid #d1d5db; color: #2F4858; background-color: #FBF9F4;">
                        Modern Finance
                    </span>
                    <span style="padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid #d1d5db; color: #2F4858; background-color: #FBF9F4;">
                        Investment Strategy
                    </span>
                    <span style="padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid #d1d5db; color: #2F4858; background-color: #FBF9F4;">
                        Economic History
                    </span>
                    <span style="padding: 8px 16px; border-radius: 20px; font-size: 14px; font-weight: 500; border: 1px solid #d1d5db; color: #2F4858; background-color: #FBF9F4;">
                        Wealth Psychology
                    </span>
                </div>
                <p style="font-size: 14px; color: #64748b; margin-top: 15px;">
                    Topic filtering coming soon
                </p>
            </div>
        </section>
    </div>
</Layout>
