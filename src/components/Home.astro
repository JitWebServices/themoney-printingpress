---
// src/components/Home.astro
import directus from "../../lib/directus";
import { readItems } from "@directus/sdk";
import { getCategoryBadgeStyles } from "../utils/categoryStyles";

// Fetch recent posts from Directus
let recentPosts = [];
try {
    recentPosts = await directus.request(
        readItems("posts", {
            fields: [
                "slug",
                "title",
                "date_created",
                "tags",
                "short_body",
                "featured",
                "category.name",
                "category.slug",
                "category.color"
            ],
            filter: {
                site: { _eq: "marcos_vega" },
                status: { _eq: "published" }
            },
            sort: ["-featured", "-date_created"],
            limit: 3
        })
    );
} catch (error) {
    console.warn("Could not fetch posts from Directus, using fallback data");
    // Fallback to sample data with new categories
    recentPosts = [
        {
            slug: "medici-banking-empire",
            title: "The Medici Bank: Renaissance Wealth Creation",
            date_created: "2024-01-15",
            tags: ["Banking", "Renaissance", "Italy"],
            short_body: "Exploring how the Medici family built one of history's most powerful banking empires and transformed Florence into the financial capital of Europe.",
            category: { name: "History", slug: "history", color: "#8C2325" }
        },
        {
            slug: "modern-market-analysis", 
            title: "Understanding Modern Market Cycles",
            date_created: "2024-01-10",
            tags: ["Markets", "Analysis", "Investment"],
            short_body: "What historical patterns reveal about today's market dynamics and how understanding economic cycles can inform better investment decisions.",
            category: { name: "Economics", slug: "economics", color: "#8C2325" }
        },
        {
            slug: "building-personal-wealth",
            title: "The Fundamentals of Personal Wealth Building",
            date_created: "2024-01-05", 
            tags: ["Saving", "Investment", "Strategy"],
            short_body: "Timeless principles for building personal wealth that have worked across centuries, adapted for modern financial realities.",
            category: { name: "Personal Finance", slug: "personal_finance", color: "#2F4858" }
        }
    ];
}
---

<div class="max-w-screen-xl shadow-2xl mx-auto flex-1 text-slate-900" style="background-color: #f6f2ea;">
	
	<!-- Hero Section -->
	<section class="relative h-[420px] overflow-hidden">
		<img
		  src="/images/hero-map.jpg"
		  alt="Early world map symbolizing historical trade and wealth"
		  class="absolute inset-0 w-full h-full object-cover opacity-90"
		  style="filter: contrast(1.05) brightness(0.92);"
		  loading="lazy"
		  decoding="async"
		  onerror="this.style.display='none'; this.parentElement.style.background='linear-gradient(135deg, #9C272E 0%, #B83339 25%, #9C272E 50%, #B83339 75%, #9C272E 100%)';"
		/>
		<div class="absolute inset-0 bg-[linear-gradient(to_bottom,rgba(111,27,29,0.68),rgba(111,27,29,0.38)),radial-gradient(ellipse_at_50%_42%,rgba(176,138,48,0.18),transparent_60%)]"></div>
	  
		<div class="relative z-10 flex flex-col items-center justify-center h-full px-6 text-center">
		  <h1 class="font-serif tracking-tight text-4xl md:text-6xl mb-5 text-[#FBF9F4] drop-shadow-[0_2px_4px_rgba(0,0,0,0.5)]">
			Exploring Wealth Through History
		  </h1>
		  <div class="w-20 h-[3px] bg-[#B08A30] mb-6"></div>
		  <p class="max-w-3xl font-sans text-lg md:text-xl leading-relaxed text-[rgba(246,242,234,0.95)] tracking-wide">
			From ancient trade routes to modern financial markets, discover the timeless principles
			of wealth creation and the stories behind the world's greatest fortunes.
		  </p>
		</div>
	  
		<div class="absolute bottom-0 left-0 w-full h-8 bg-gradient-to-b from-[rgba(0,0,0,0.28)] to-transparent pointer-events-none"></div>
	  </section>

	<!-- Latest Posts Section -->
	<section class="py-20" style="background-color: #FBF9F4;">
		<div class="container mx-auto px-6 max-w-6xl">
			<h2 class="text-4xl font-semibold mb-12 text-center victoria-font"
				style="font-family: 'Victoria', 'Times New Roman', serif; color: #2F4858;">
				Latest Insights
			</h2>
			
			<div class="grid md:grid-cols-1 gap-8 mb-12">
				{recentPosts.map((post) => {
					const categoryBadgeStyle = post.category ? getCategoryBadgeStyles(post.category.slug) : null;
					
					return (
						<div class="border-b border-gray-200 pb-8 last:border-b-0">
							<div class="p-4 mx-auto">
								<a href={`/blog/${post.slug}`} class="font-semibold">
									<div class="flex flex-col gap-3">
										{post.featured && (
											<div class="flex items-center gap-2 mb-2">
												<span class="px-3 py-1 rounded-full text-xs font-medium text-white" 
													  style="background-color: #B08A30;">
													‚≠ê Featured
												</span>
											</div>
										)}
										
										<h2 class="text-3xl hover:text-slate-900 transition-colors duration-200"
											style="color: #2F4858;">
											{post.title}
										</h2>
										
										<div class="flex flex-wrap gap-2 mb-2">
											{post.category && categoryBadgeStyle && (
												<span 
													class="px-3 py-1 rounded-full text-sm font-medium"
													style={`background-color: ${categoryBadgeStyle.backgroundColor}; border: ${categoryBadgeStyle.border}; color: ${categoryBadgeStyle.color};`}
												>
													{post.category.name}
												</span>
											)}
											{post.tags && post.tags.map((tag) => (
												<span class="text-gray-700 px-3 py-1 rounded-full text-sm border"
													  style="background-color: #f9f9f9; border-color: #d1d5db; color: #6b7280;">
													{tag}
												</span>
											))}
										</div>
										
										<p class="text-gray-500 border-t-1 border-b-1 border-gray-300 py-2 mb-2">
											{new Date(post.date_created).toLocaleDateString("en-US", {
												year: "numeric",
												month: "long", 
												day: "numeric",
											})}
										</p>
										
										<div class="text-gray-700 text-xl leading-relaxed">
											{post.short_body}
										</div>
									</div>
								</a>
							</div>
						</div>
					);
				})}
			</div>
			
			<div class="text-center">
				<a
					href="/blog"
					class="inline-block text-white font-semibold px-8 py-3 rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl"
					style="background: linear-gradient(135deg, #9e383d, #7f1d1d);"
					onmouseover="this.style.transform='translateY(-2px)'"
					onmouseout="this.style.transform='translateY(0)'"
				>
					View All Posts
				</a>
			</div>
		</div>
	</section>

	<!-- About Teaser Section -->
	<section class="py-20" style="background-color: #f6f2ea;">
		<div class="container mx-auto px-6 max-w-4xl text-center">
			<h2 class="text-3xl font-semibold mb-6 victoria-font"
				style="font-family: 'Victoria', 'Times New Roman', serif; color: #2F4858;">
				The Money-Printing Press
			</h2>
			<p class="text-xl text-slate-700 mb-8 max-w-3xl mx-auto leading-relaxed">
				A deep dive into the history of wealth, from the merchant princes of Venice 
				to the tech titans of Silicon Valley. Understanding how fortunes are built, 
				lost, and rebuilt across the centuries.
			</p>
			<a
				href="/about"
				class="inline-block border-2 text-slate-800 font-semibold px-8 py-3 rounded-lg transition-all duration-200 hover:shadow-lg"
				style="border-color: #d4af37; color: #9e383d;"
				onmouseover="this.style.backgroundColor='#d4af37'; this.style.color='white'; this.style.transform='translateY(-1px)'"
				onmouseout="this.style.backgroundColor='transparent'; this.style.color='#9e383d'; this.style.transform='translateY(0)'"
			>
				Learn More About This Project
			</a>
		</div>
	</section>

	<!-- Featured Topics -->
	<section class="py-20" style="background-color: #FBF9F4;">
		<div class="container mx-auto px-6 max-w-6xl">
			<h2 class="text-3xl font-semibold text-center mb-12 victoria-font"
				style="font-family: 'Victoria', 'Times New Roman', serif; color: #2F4858;">
				Explore Categories
			</h2>
			<div class="grid md:grid-cols-3 gap-8">
				<div class="p-8 rounded-2xl shadow-sm text-center hover:shadow-lg transition-all duration-200" style="background-color: #f6f2ea;">
					<div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg"
						 style="background: linear-gradient(135deg, #8C2325, #A02A2C);">
						<span class="text-white text-2xl">üèõÔ∏è</span>
					</div>
					<h3 class="text-xl font-semibold mb-4 victoria-font"
						style="font-family: 'Victoria', 'Times New Roman', serif; color: #2F4858;">
						<a href="/blog?category=history" class="hover:underline">
							History
						</a>
					</h3>
					<p class="text-slate-700 leading-relaxed">
						Stories of wealth and power throughout the ages, from ancient empires to modern dynasties.
					</p>
				</div>
				<div class="p-8 rounded-2xl shadow-sm text-center hover:shadow-lg transition-all duration-200" style="background-color: #f6f2ea;">
					<div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg"
						 style="background: linear-gradient(135deg, #2F4858, #1e3a4a);">
						<span class="text-white text-2xl">üí∞</span>
					</div>
					<h3 class="text-xl font-semibold mb-4 victoria-font"
						style="font-family: 'Victoria', 'Times New Roman', serif; color: #2F4858;">
						<a href="/blog?category=personal_finance" class="hover:underline">
							Personal Finance
						</a>
					</h3>
					<p class="text-slate-700 leading-relaxed">
						Practical strategies for building and preserving individual wealth.
					</p>
				</div>
				<div class="p-8 rounded-2xl shadow-sm text-center hover:shadow-lg transition-all duration-200" style="background-color: #f6f2ea;">
					<div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg"
						 style="background: linear-gradient(135deg, #B08A30, #8E6C1E);">
						<span class="text-white text-2xl">üåç</span>
					</div>
					<h3 class="text-xl font-semibold mb-4 victoria-font"
						style="font-family: 'Victoria', 'Times New Roman', serif; color: #2F4858;">
						<a href="/blog?category=culture" class="hover:underline">
							Culture
						</a>
					</h3>
					<p class="text-slate-700 leading-relaxed">
						How cultural attitudes and social norms influence wealth creation and distribution.
					</p>
				</div>
				<div class="p-8 rounded-2xl shadow-sm text-center hover:shadow-lg transition-all duration-200" style="background-color: #f6f2ea;">
					<div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg"
						 style="background: linear-gradient(135deg, #8C2325, #A02A2C);">
						<span class="text-white text-2xl">üìä</span>
					</div>
					<h3 class="text-xl font-semibold mb-4 victoria-font"
						style="font-family: 'Victoria', 'Times New Roman', serif; color: #2F4858;">
						<a href="/blog?category=economics" class="hover:underline">
							Economics
						</a>
					</h3>
					<p class="text-slate-700 leading-relaxed">
						Economic principles, market analysis, and the forces that shape prosperity.
					</p>
				</div>
				<div class="p-8 rounded-2xl shadow-sm text-center hover:shadow-lg transition-all duration-200" style="background-color: #f6f2ea;">
					<div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg"
						 style="background: linear-gradient(135deg, #6F7F53, #5a6b42);">
						<span class="text-white text-2xl">üèñÔ∏è</span>
					</div>
					<h3 class="text-xl font-semibold mb-4 victoria-font"
						style="font-family: 'Victoria', 'Times New Roman', serif; color: #2F4858;">
						<a href="/blog?category=lifestyle" class="hover:underline">
							Lifestyle
						</a>
					</h3>
					<p class="text-slate-700 leading-relaxed">
						The intersection of wealth and living well across different eras and societies.
					</p>
				</div>
				<div class="p-8 rounded-2xl shadow-sm text-center hover:shadow-lg transition-all duration-200" style="background-color: #f6f2ea;">
					<div class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg"
						 style="background: linear-gradient(135deg, #A02A2C, #8C2325);">
						<span class="text-white text-2xl">üí≠</span>
					</div>
					<h3 class="text-xl font-semibold mb-4 victoria-font"
						style="font-family: 'Victoria', 'Times New Roman', serif; color: #2F4858;">
						<a href="/blog?category=opinion" class="hover:underline">
							Opinion
						</a>
					</h3>
					<p class="text-slate-700 leading-relaxed">
						Editorial perspectives and commentary on wealth, society, and financial trends.
					</p>
				</div>
			</div>
		</div>
	</section>

	<!-- Newsletter Signup -->
	<section class="py-20" style="background: linear-gradient(135deg, #7f1d1d 0%, #9e383d 50%, #7f1d1d 100%);">
		<div class="container mx-auto px-6 text-center">
			<h2 class="text-3xl font-semibold text-white mb-4 victoria-font"
				style="font-family: 'Victoria', 'Times New Roman', serif; color: #d4af37;">
				Join the Press
			</h2>
			<p class="text-gray-200 mb-8 max-w-2xl mx-auto leading-relaxed">
				Get weekly insights on wealth, history, and the timeless principles 
				of building lasting prosperity.
			</p>
			<form class="flex flex-col sm:flex-row items-center gap-4 justify-center max-w-md mx-auto">
				<input
					type="email"
					placeholder="your@email.com"
					class="w-full px-4 py-3 rounded-lg text-slate-900 placeholder-slate-500 focus:outline-none focus:ring-2 transition-all duration-200"
					style="focus:ring-color: #d4af37;"
				/>
				<button
					type="submit"
					class="px-6 py-3 font-semibold rounded-lg transition-all duration-200 whitespace-nowrap hover:shadow-lg"
					style="background-color: #d4af37; color: #9e383d;"
					onmouseover="this.style.backgroundColor='#b8941f'; this.style.transform='translateY(-1px)'"
					onmouseout="this.style.backgroundColor='#d4af37'; this.style.transform='translateY(0)'"
				>
					Subscribe
				</button>
			</form>
		</div>
	</section>
</div>

<style>
	.victoria-font {
		font-family: 'Victoria', 'Times New Roman', serif;
	}
</style>